{% extends "base.html" %}
{% load static %}
{% block title %}Seat Selection{% endblock title %}

{% block content %}

    <style>
    .seat {
    display: inline-block;
    width: 40px;
    height: 40px;
    margin: 5px;
    line-height: 40px;
    text-align: center;
    border-radius: 5px;
    cursor: pointer;
    border: 1px solid #ccc;
    background-color: #e0e0e0;
    font-weight: bold;
    }

    .seat.selected {
    background-color: #28a745;
    color: #fff;
    }

    .seat.booked {
    background-color: #6c757d;
    cursor: not-allowed;
    color: #fff;
    }
    </style>


    <div class="container my-5">
        <h2 class="mb-4">{{ showtime.movie_name.title }}</h2>
        <h4>{{ showtime.theater.name }}</h4>
        <p class="text-muted">{{ showtime.theater.address }}</p>
        <p><strong>Showtime:</strong> {{ showtime.show_time|date:"d M Y, h:i A" }}</p>

        <hr>

        <h5 class="mt-4">Seats:</h5>

        <!-- Recliner -->
        <h6 class="mt-3 text-danger">Recliner (₹{{ showtime.platinum_seats }})</h6>
        {% for row_label, seats in seat_rows.items %}
        <div class="mt-3">
            <strong>{{ row_label.0 }} - {{ row_label.1|upper }}</strong><br>
            {% for seat in seats %}
                <div class="seat" 
                    onclick="toggleSeat(this, '{{ seat.id }}', '{{ row_label.1 }}')">
                    {{ seat.seat_number }}
                </div>
            {% endfor %}
        </div>
    {% endfor %}

        <!-- Gold -->
        <h6 class="mt-4 text-warning">Gold (₹{{ showtime.gold_seats }})</h6>
        {% for row_label, seats in seat_rows.items %}
        <div class="mt-3">
            <strong>{{ row_label.0 }} - {{ row_label.1|upper }}</strong><br>
            {% for seat in seats %}
                <div class="seat" 
                    onclick="toggleSeat(this, '{{ seat.id }}', '{{ row_label.1 }}')">
                    {{ seat.seat_number }}
                </div>
            {% endfor %}
        </div>
    {% endfor %}

        <!-- Silver -->
        <h6 class="mt-4 text-secondary">Silver (₹{{ showtime.silver_seats }})</h6>
        {% for row_label, seats in seat_rows.items %}
        <div class="mt-3">
            <strong>{{ row_label.0 }} - {{ row_label.1|upper }}</strong><br>
            {% for seat in seats %}
                <div class="seat" 
                    onclick="toggleSeat(this, '{{ seat.id }}', '{{ row_label.1 }}')">
                    {{ seat.seat_number }}
                </div>
            {% endfor %}
        </div>
    {% endfor %}

    <div class="mt-4">
        <h5>Selected Seats: <span id="selected-seats">None</span></h5>
        <h5>Total Amount: <span id="total-amount">₹0</span></h5>
    </div>


        <form method="post" action="{% url 'booking_ticket' showtime.id %}" class="mt-4">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary mt-4">Pay ₹{{ total_amount }}</button>
        </form>

    </div>



    <script>
    let selectedSeats = [];
    let seatPrice = {
        'silver': {{ showtime.silver_seats|default:150 }},
        'gold': {{ showtime.gold_seats|default:250 }},
        'recliner': {{ showtime.platinum_seats|default:400 }}
    };

    function toggleSeat(seatEl, seatId, seatType) {
        if (seatEl.classList.contains('booked')) return;

        seatEl.classList.toggle('selected');

        if (seatEl.classList.contains('selected')) {
            selectedSeats.push({ id: seatId, type: seatType });
        } else {
            selectedSeats = selectedSeats.filter(seat => seat.id !== seatId);
        }

        updateSummary();
    }

    function updateSummary() {
        let totalAmount = selectedSeats.reduce((sum, seat) => sum + seatPrice[seat.type], 0);
        document.getElementById('selected-seats').innerText = selectedSeats.map(s => s.id).join(', ') || 'None';
        document.getElementById('total-amount').innerText = '₹' + totalAmount;
    }
    </script>


{% endblock %}
